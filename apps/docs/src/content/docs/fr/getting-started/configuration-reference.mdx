---
title: R√©f√©rence de Configuration
description: Un guide complet pour configurer votre instance Karr.
next: false
---

import yamlConfig from "@/assets/config-examples/config_file.yaml?raw";
import jsonConfig from "@/assets/config-examples/config_file.json?raw";
import json5Config from "@/assets/config-examples/config_file.json5?raw";
import { Aside, Code } from "@astrojs/starlight/components";

Au minimum, vous devez d√©finir l'`APP_URL` pour que votre instance fonctionne correctement.
Ce guide fournit une r√©f√©rence compl√®te de toutes les options de configuration disponibles dans Karr.

## M√©thodes de configuration

Karr peut √™tre configur√© via un fichier de configuration ou des variables d'environnement.

### Variables d'environnement

Tout champ du fichier de configuration peut √™tre d√©fini avec une variable d'environnement.

Elles suivent la m√™me nomenclature que leur √©quivalent dans le fichier de configuration.
La seule exception est la configuration de la base de donn√©es, qui est pr√©fix√©e par `DB_`,
par exemple `DB_NAME`, `DB_PASSWORD`, `DB_PASSWORD_FILE`...

### Fichier de configuration

Par d√©faut, le fichier de configuration doit √™tre situ√© dans un r√©pertoire `config/` √† la racine du projet et nomm√© `karr.config.*`.
Ces emplacements peuvent √™tre modifi√©s par les variables d'environnement `CONFIG_DIR` et `CONFIG_FILENAME` respectivement.

Le fichier de configuration peut √™tre au format YAML, [JSON5](https://json5.org/), ou JSON.

Le sch√©ma de configuration est disponible sur [https://karr.mobi/config.schema.json](https://karr.mobi/config.schema.json).

## Champs obligatoires

| Option    | Type | Description                                                                                                 |
| --------- | ---- | ----------------------------------------------------------------------------------------------------------- |
| `APP_URL` | URL  | L'URL de base o√π votre instance Karr peut √™tre accessible, sans aucun chemin suppl√©mentaire. Doit se terminer par un `/`. |

## Configuration g√©n√©rale

| Option             | Type    | D√©faut   | Description                                                                                       |
| ------------------ | ------- | -------- | ------------------------------------------------------------------------------------------------- |
| `APPLICATION_NAME` | String  | `"Karr"` | Le nom de votre instance d'application.                                                           |
| `API_PORT`         | Number  | `1993`   | Le port sur lequel le serveur API √©coutera.                                                       |
| `API_BASE`         | String  | `"/api"` | Le chemin de base pour les points de terminaison API. Doit commencer par un `/` sans slash final. |
| `LOG_TIMESTAMP`    | Boolean | `true`   | Indique si les horodatages doivent √™tre inclus dans les journaux.                                 |
| `LOG_LEVEL`        | String  | `"info"` | Le niveau de journal √† utiliser. Options disponibles : `"trace"`, `"debug"`, `"info"`, `"warn"`, `"error"`. |
| `ADMIN_EMAIL`      | Email   |          | L'adresse e-mail de l'utilisateur administrateur.                                                 |

## Authentification

Karr prend en charge plusieurs fournisseurs d'authentification via l'option de configuration `AUTH_PROVIDERS`.

### Fournisseurs pris en charge

#### Authentification locale

- [Mot de passe](#local-providers) : Authentification par e-mail/mot de passe
- [Code](#local-providers) : Authentification par code √† usage unique via e-mail

#### Fournisseurs OAuth/OIDC

- [GitHub](#github) : Authentification OAuth GitHub.
  Suivez [la documentation officielle](https://docs.github.com/en/apps/oauth-apps/building-oauth-apps/creating-an-oauth-app) pour obtenir un ID client et un secret.
- [Google](#google) : Authentification OIDC Google.
  Suivez [la documentation officielle](https://developers.google.com/identity/openid-connect/openid-connect) pour obtenir un ID client.
  (D√©sol√©, la documentation est assez confuse)

<Aside>
    Pour utiliser les fournisseurs OAuth/OIDC, vous devrez enregistrer votre application aupr√®s
    du service respectif et obtenir des identifiants client.
</Aside>

### Options

#### Fournisseurs locaux

| Option    | Obligatoire | Type    | Description                                                                                                   |
| --------- | ----------- | ------- | ------------------------------------------------------------------------------------------------------------- |
| `name`    | ‚úî          | String  | Le nom du fournisseur (`password` ou `code`)                                                                  |
| `trusted` |             | Boolean | Lorsque d√©fini sur `true`, les utilisateurs authentifi√©s via ce fournisseur sont consid√©r√©s v√©rifi√©s. Par d√©faut : `false`. |

#### Github

| Option         | Obligatoire | Type    | Description                                                                                                |
| -------------- | ----------- | ------- | ---------------------------------------------------------------------------------------------------------- |
| `name`         | ‚úî          | String  | Le nom du fournisseur (`github`)                                                                           |
| `clientID`     | ‚úî          | String  | L'ID client du fournisseur d'authentification                                                              |
| `clientSecret` | ‚úî          | String  | Le secret client du fournisseur d'authentification                                                         |
| `query`        |             | Object  | Param√®tres de requ√™te suppl√©mentaires √† inclure dans les demandes d'autorisation.                          |
| `trusted`      |             | Boolean | Lorsque d√©fini sur `true`, les utilisateurs authentifi√©s via Github sont consid√©r√©s v√©rifi√©s. Par d√©faut : `false`. |

#### Google

| Option     | Obligatoire | Type    | Description                                                                                                |
| ---------- | ----------- | ------- | ---------------------------------------------------------------------------------------------------------- |
| `name`     | ‚úî          | String  | Le nom du fournisseur (`google`)                                                                           |
| `clientID` | ‚úî          | String  | L'ID client du fournisseur d'authentification                                                              |
| `query`    |             | Object  | Param√®tres de requ√™te suppl√©mentaires √† inclure dans les demandes d'autorisation.                          |
| `trusted`  |             | Boolean | Lorsque d√©fini sur `true`, les utilisateurs authentifi√©s via Google sont consid√©r√©s v√©rifi√©s. Par d√©faut : `false`. |

## F√©d√©ration

üöÄ **Bient√¥t disponible ! Ce n'est pas encore impl√©ment√©, cela viendra dans un futur proche.**

Vous pouvez sp√©cifier directement les instances cibles avec lesquelles f√©d√©rer.

## Base de donn√©es

Les d√©tails de connexion √† la base de donn√©es peuvent √™tre configur√©s via l'option `DB_CONFIG` :

| Option          | Type    | D√©faut        | Description                                                                                                  |
| --------------- | ------- | ------------- | ------------------------------------------------------------------------------------------------------------ |
| `host`          | String  | `"localhost"` | Nom d'h√¥te du serveur de base de donn√©es.                                                                   |
| `port`          | Number  | `5432`        | Port du serveur de base de donn√©es.                                                                          |
| `user`          | String  | `"postgres"`  | Nom d'utilisateur de la base de donn√©es.                                                                     |
| `password`      | String  |               | Mot de passe de la base de donn√©es. Non recommand√© pour une utilisation en production.                       |
| `password_file` | String  |               | Chemin d'acc√®s √† un fichier contenant le mot de passe de la base de donn√©es. Recommand√© pour la production avec Docker Secrets. |
| `db_name`       | String  | `"karr"`      | Nom de la base de donn√©es.                                                                                   |
| `ssl`           | Boolean | `false`       | Indique s'il faut utiliser SSL pour les connexions √† la base de donn√©es.                                     |

<Aside type="caution">
    Soit `password` soit `password_file` doit √™tre sp√©cifi√©, mais pas les deux. Pour
    les environnements de production, l'utilisation de `password_file` avec Docker Secrets est
    fortement recommand√©e.
</Aside>

## Exemple de configuration

Voici un exemple de configuration compl√®te :

### YAML

<Code code={yamlConfig} lang="yaml" title="config/karr.config.yaml" />

### JSON

<Code code={jsonConfig} lang="json" title="config/karr.config.json" />

### JSON5

<Code code={json5Config} lang="json" title="config/karr.config.json5" />

<Aside type="tip">
    Pour plus d'informations sur les fournisseurs d'authentification et la f√©d√©ration, consultez
    les guides avanc√©s dans la documentation.
</Aside>
